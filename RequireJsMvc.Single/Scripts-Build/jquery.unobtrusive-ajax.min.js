/*
** Unobtrusive Ajax support library for jQuery
** Copyright (C) Microsoft Corporation. All rights reserved.
*/

(function(e){function r(e,t){var n=window,r=(e||"").split(".");while(n&&r.length)n=n[r.shift()];return typeof n=="function"?n:(t.push(e),Function.constructor.apply(null,t))}function i(e){return e==="GET"||e==="POST"}function s(e,t){!i(t)&&e.setRequestHeader("X-HTTP-Method-Override",t)}function o(t,n,r){var i;if(r.indexOf("application/x-javascript")!==-1)return;i=(t.getAttribute("data-ajax-mode")||"").toUpperCase(),e(t.getAttribute("data-ajax-update")).each(function(t,r){var s;switch(i){case"BEFORE":s=r.firstChild,e("<div />").html(n).contents().each(function(){r.insertBefore(this,s)});break;case"AFTER":e("<div />").html(n).contents().each(function(){r.appendChild(this)});break;default:e(r).html(n)}})}function u(t,n){var u,a,l,p;u=t.getAttribute("data-ajax-confirm");if(u&&!window.confirm(u))return;a=e(t.getAttribute("data-ajax-loading")),p=t.getAttribute("data-ajax-loading-duration")||0,e.extend(n,{type:t.getAttribute("data-ajax-method")||undefined,url:t.getAttribute("data-ajax-url")||undefined,beforeSend:function(e){var n;return s(e,l),n=r(t.getAttribute("data-ajax-begin"),["xhr"]).apply(this,arguments),n!==!1&&a.show(p),n},complete:function(){a.hide(p),r(t.getAttribute("data-ajax-complete"),["xhr","status"]).apply(this,arguments)},success:function(e,n,i){o(t,e,i.getResponseHeader("Content-Type")||"text/html"),r(t.getAttribute("data-ajax-success"),["data","status","xhr"]).apply(this,arguments)},error:r(t.getAttribute("data-ajax-failure"),["xhr","status","error"])}),n.data.push({name:"X-Requested-With",value:"XMLHttpRequest"}),l=n.type.toUpperCase(),i(l)||(n.type="POST",n.data.push({name:"X-HTTP-Method-Override",value:l})),e.ajax(n)}function a(t){var r=e(t).data(n);return!r||!r.validate||r.validate()}var t="unobtrusiveAjaxClick",n="unobtrusiveValidation";e("a[data-ajax=true]").live("click",function(e){e.preventDefault(),u(this,{url:this.href,type:"GET",data:[]})}),e("form[data-ajax=true] input[type=image]").live("click",function(n){var r=n.target.name,i=e(n.target),s=i.parents("form")[0],o=i.offset();e(s).data(t,[{name:r+".x",value:Math.round(n.pageX-o.left)},{name:r+".y",value:Math.round(n.pageY-o.top)}]),setTimeout(function(){e(s).removeData(t)},0)}),e("form[data-ajax=true] :submit").live("click",function(n){var r=n.target.name,i=e(n.target).parents("form")[0];e(i).data(t,r?[{name:r,value:n.target.value}]:[]),setTimeout(function(){e(i).removeData(t)},0)}),e("form[data-ajax=true]").live("submit",function(n){var r=e(this).data(t)||[];n.preventDefault();if(!a(this))return;u(this,{url:this.action,type:this.method||"GET",data:r.concat(e(this).serializeArray())})})})(jQuery);